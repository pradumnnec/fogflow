version: "3.1"

volumes:
    mongodb: ~

services:
    iot-agent:
        image: fiware/iotagent-ul:latest
        hostname: iot-agent
        container_name: fiware-iot-agent
        depends_on:
            - mongo-db
        networks:
            - default
        expose:
            - "4041"
            - "7896"
        ports:
            - "4041:4041"
            - "7896:7896"
        environment:
            - "IOTA_CB_HOST=fogflow"  
            - "IOTA_CB_PORT=8070"
            - "IOTA_NORTH_PORT=4041"
            - "IOTA_REGISTRY_TYPE=mongodb"
            - "IOTA_LOG_LEVEL=DEBUG"
            - "IOTA_TIMESTAMP=true"
            - "IOTA_CB_NGSI_VERSION=ld"
            - "IOTA_AUTOCAST=true"
            - "IOTA_MONGO_HOST=mongodb"
            - "IOTA_MONGO_PORT=27017"
            - "IOTA_MONGO_DB=iotagentul"
            - "IOTA_HTTP_PORT=7896"
            - "IOTA_PROVIDER_URL=http://iot-agent:4041"
            - "IOTA_JSON_LD_CONTEXT=http://context:3000/data-models/ngsi-context.jsonld"
            - "IOTA_FALLBACK_TENANT=openiot"

    mongo-db:
        image: mongo:4.2
        hostname: mongodb
        container_name: db-mongo
        ports:
            - "27017:27017"
        volumes:
            - mongodb:/data

    tutorial:
        image: fiware/tutorials.ngsi-ld
        hostname: iot-sensors
        container_name: fiware-tutorial
        networks:
            - default
        expose:
            - "3000"
            - "3001"
        ports:
            - "3000:3000"
            - "3001:3000"
        environment:
            - "DEBUG=tutorial:*"
            - "PORT=3000"
            - "IOTA_HTTP_HOST=180.179.214.202"
            - "IOTA_HTTP_PORT=7896"
            - "DUMMY_DEVICES_PORT=3001"
            - "DUMMY_DEVICES_API_KEY=4jggokgpepnvsb2uv4s40d59ov"
            - "DUMMY_DEVICES_TRANSPORT=HTTP"
            - "IOTA_JSON_LD_CONTEXT=https://uri.etsi.org/ngsi-ld/v1/ngsi-ld-core-context.jsonld"
